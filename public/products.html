<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S·∫£n ph·∫©m</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
    <style>
        .product-list { padding: 20px; }
        .product- { margin-bottom: 40px; }
        .product- h2 { margin-bottom: 15px; }
        .product-grid { display: flex; flex-wrap: wrap; gap: 15px; }
        .product-card img {
            width: 100%;
            height: 200px;          /* üî• KH√ìA CHI·ªÄU CAO */
            object-fit: contain;   /* gi·ªØ t·ªâ l·ªá ·∫£nh */
            margin-bottom: 10px;
        }
        .product-item { flex: 0 0 calc(25% - 15px); border: 1px solid #ccc; padding: 10px; text-align: center; }
        .product-item img { width: 100%; height: auto; object-fit: contain; }
        .product-item p { margin-top: 8px; font-size: 14px; }
        @media (max-width: 1024px) { .product-item { flex: 0 0 calc(33.33% - 15px); } }
        @media (max-width: 768px) { .product-item { flex: 0 0 calc(50% - 15px); } }
        @media (max-width: 480px) { .product-item { flex: 0 0 100%; } }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <main class="main-content">
        <section class="hero-banner" aria-label="Banner">
            <img src="https://mega.com.vn/media/news/2605_hinh-nen-cong-nghe-pc47.jpg" alt="Banner" class="bg-image">
            <div class="hero-content">
                <h1>K·∫øt qu·∫£ t√¨m ki·∫øm</h1>
            </div>
        </section>

        <section class="product-list" id="productList"></section>
    </main>

    <div id="footer-placeholder"></div>

    <script src="js/header.js"></script>
    <script src="js/cart.js"></script>
    <script>
        // Load header/footer
        function loadHTML(elementId, file, callback) {
            fetch(file).then(r => r.text()).then(html => {
                document.getElementById(elementId).innerHTML = html;
                if (callback) callback();
            }).catch(err => console.error('L·ªói load component', file, err));
        }
        loadHTML('header-placeholder', 'component/header.html', () => document.body.classList.add('has-fixed-header'));
        loadHTML('footer-placeholder', 'component/footer.html');

        // --- Render products ---
        document.addEventListener('DOMContentLoaded', async () => {
            const container = document.getElementById('productList');
            const q = new URLSearchParams(window.location.search).get('q') || '';

            container.innerHTML = '<p>ƒêang t·∫£i...</p>';

            try {
                let apiUrl;

                if (q) {
                    apiUrl = `http://127.0.0.1:3000/api/products/by-category/${encodeURIComponent(q)}`;
                } else {
                    apiUrl = `http://127.0.0.1:3000/api/products`;
                }

                const res = await fetch(apiUrl);
                const data = await res.json();
                let products = data.products || [];

                if (!products.length) {
                    container.innerHTML = '<p>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o.</p>';
                    return;
                }

                container.innerHTML = '';

            container.innerHTML = '';

// Nh√≥m theo category_id ho·∫∑c category_name
const grouped = {};

products.forEach(p => {
    const cat = p.category_name || 'Kh√°c';
    if (!grouped[cat]) grouped[cat] = [];
    grouped[cat].push(p);
});

container.innerHTML = '';

for (const [catName, items] of Object.entries(grouped)) {
    const section = document.createElement('section');
    section.className = 'category-block';

    section.innerHTML = `
        <h2>${catName}</h2>
        <div class="product-grid"></div>
    `;

    const grid = section.querySelector('.product-grid');

    items.forEach(p => {
        const price = new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND'
        }).format(p.price);

        const card = document.createElement('div');
        card.className = 'product-card';

        
        card.innerHTML = `
            <a href="product.html?code=${p.product_code}">
                <img src="${p.primaryImage}">
                <h3>${p.name}</h3>
                <p class="price">${price}</p>
            </a>
        `;

        grid.appendChild(card);
    });

    container.appendChild(section);
}


            } catch (err) {
                console.error('L·ªói fetch products:', err);
                container.innerHTML = '<p>L·ªói khi t·∫£i s·∫£n ph·∫©m.</p>';
            }
        });
    </script>
</body>
</html>
