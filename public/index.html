<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gaming Gear</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
</head>

<body>
    <!-- Header -->
    <div id="header-placeholder"></div>

    <!-- Main Content -->
    <div id="mainContent-placeholder"></div>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- Load Components -->
    <script src="js/menu.js"></script>
    <script src="js/search.js"></script>
    <script src="js/productsFeed.js"></script>
    <script>
        function loadHTML(elementId, file, callback) {
            fetch(file)
                .then(response => response.text())
                .then(data => {
                    document.getElementById(elementId).innerHTML = data;
                    if (callback) callback(); // Gọi callback sau khi tải xong
                })
                .catch(error => console.error(`Lỗi khi tải ${file}:`, error));
        }

        function setupHeaderEvents() {
            console.log("✅ Header đã tải xong, bắt đầu gán sự kiện.");

            // Xử lý sự kiện đăng nhập
            const loginContainer = document.querySelector(".login-container");
            const loginPopup = document.getElementById("loginPopup");
            let hoverTimeout;

            function showPopup() {
                clearTimeout(hoverTimeout);
                loginPopup.style.display = "block";
            }

            function hidePopupWithDelay() {
                hoverTimeout = setTimeout(() => {
                    loginPopup.style.display = "none";
                }, 200);
            }

            if (loginContainer && loginPopup) {
                loginContainer.addEventListener("mouseenter", showPopup);
                loginContainer.addEventListener("mouseleave", hidePopupWithDelay);
                loginPopup.addEventListener("mouseenter", showPopup);
                loginPopup.addEventListener("mouseleave", hidePopupWithDelay);
            }

            window.showLoginPopup = function () {
                const popup = document.getElementById('popup-container');
                popup.style.display = 'flex';
                popup.innerHTML = `
                <div class="modallogin">
                    <div class="modal-content">
                        <h2 style="text-align: center">ĐĂNG NHẬP TÀI KHOẢN</h2>
                        <form>
                            <div class="input-container">
                                <i class='bx bx-envelope'></i>
                                <input type="email" placeholder="Email" required>
                            </div>
                            <div class="input-container">
                                <i class='bx bx-lock'></i>
                                <input type="password" placeholder="Mật khẩu" required>
                            </div>
                            <a href="#" style="text-align: right"><u>Quên mật khẩu email?</u></a>
                            <button type="submit"><b>ĐĂNG NHẬP</b></button>
                        </form>
                        <div class="hrs-container">
                            <hr>
                            <span class="hrs-text">hoặc đăng nhập bằng</span>
                        </div>
                        <div class="social-buttons">
                            <button class="google"><i class='bx bxl-google'></i> Google</button>
                            <button class="facebook"><i class='bx bxl-facebook'></i> Facebook</button>
                        </div>
                        <p>Bạn chưa có tài khoản? <a href="#" onclick="showRegisterPopup()">Đăng ký ngay!</a></p>
                    </div>
                </div>`;
            };

            window.showRegisterPopup = function () {
                const popup = document.getElementById('popup-container');
                popup.style.display = 'flex';
                popup.innerHTML = `
                <div class="modalregis">
                    <div class="modal-content-regis">
                        <h2 style="text-align: center">ĐĂNG KÝ TÀI KHOẢN</h2>
                        <form>
                            <div class="input-container">
                                <i class='bx bx-envelope'></i>
                                <input type="email" placeholder="Email" required>
                            </div>
                            <div class="input-container">
                                <i class='bx bx-user'></i>
                                <input type="text" placeholder="Họ" required>
                            </div>
                            <div class="input-container">
                                <i class='bx bx-user'></i>
                                <input type="text" placeholder="Tên" required>
                            </div>
                            <div class="input-container">
                                <i class='bx bx-lock'></i>
                                <input type="password" placeholder="Mật khẩu" required>
                            </div>
                            <button type="submit"><b>TẠO TÀI KHOẢN</b></button>
                        </form>
                        <div class="hr-container">
                            <hr>
                            <span class="hr-text">hoặc đăng ký bằng</span>
                        </div>
                        <div class="social-buttons">
                            <button class="google"><i class='bx bxl-google'></i> Google</button>
                            <button class="facebook"><i class='bx bxl-facebook'></i> Facebook</button>
                        </div>
                        <p>Bạn đã có tài khoản? <a href="#" onclick="showLoginPopup()">Đăng nhập!</a></p>
                    </div>
                </div>`;
            };

            window.closePopup = function () {
                const popup = document.getElementById('popup-container');
                popup.style.display = 'none';
                popup.innerHTML = '';
            };

            document.getElementById('popup-container').addEventListener('click', function (event) {
                if (event.target === this) {
                    closePopup();
                }
            });
        }
        function adjustRelativePaths(containerId, basePath) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const elementsWithSrc = container.querySelectorAll("[src], [href]");

            elementsWithSrc.forEach(el => {
                const attr = el.hasAttribute("src") ? "src" : "href";
                const original = el.getAttribute(attr);

                if (original && !original.startsWith("http") && !original.startsWith("/")) {
                    el.setAttribute(attr, basePath + original);
                }
            });
        }

        loadHTML("header-placeholder", "component/header.html", () => {
            document.body.classList.add("has-fixed-header");
            setupHeaderEvents();
        });
        loadHTML("footer-placeholder", "component/footer.html");
        loadHTML("mainContent-placeholder", "component/mainContent.html", () => {
            if (window.initProducts) window.initProducts();
        });
    </script>


</body>

</html>